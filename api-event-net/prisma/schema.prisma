generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String      @id @default(uuid())
  name      String
  email     String
  password  String
  phone     String
  role      UserRole    @default(common)
  Address   Address[]
  Chat      Chat[]
  Message   Message[]
  Profile   Profile[]
  UserEvent UserEvent[]

  @@map("users")
}

model Address {
  id           String  @id @default(uuid())
  city         String?
  state        String?
  neighborhood String?
  userId       String  @unique @map("user_id")
  user         User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("address")
}

model Profile {
  id        String  @id @default(uuid())
  bio       String?
  avatar    String?
  github    String?
  linkedin  String?
  instagram String?
  userId    String  @unique @map("user_id")
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("profiles")
}

model Event {
  id             String      @id @default(uuid())
  title          String
  description    String
  start_datetime DateTime
  end_datetime   DateTime
  location       String
  qr_code        String
  image          String
  Chat           Chat[]
  UserEvent      UserEvent[]

  @@map("events")
}

model UserEvent {
  id      String    @id @default(uuid())
  userId  String    @map("user_id")
  eventId String    @map("event_id")
  role    EventRole @default(participant)
  event   Event     @relation(fields: [eventId], references: [id])
  user    User      @relation(fields: [userId], references: [id])

  @@map("user_event")
}

model Chat {
  id          String    @id @default(uuid())
  recipientId String    @map("recipient_id")
  eventId     String    @map("event_id")
  type        ChatType
  event       Event     @relation(fields: [eventId], references: [id])
  user        User      @relation(fields: [recipientId], references: [id])
  Message     Message[]

  @@map("chats")
}

model Message {
  id       String        @id @default(uuid())
  content  String
  dateTime DateTime      @map("date_time")
  senderId String        @map("sender_id")
  chatId   String        @map("chat_id")
  status   MessageStatus @default(delivered)
  chat     Chat          @relation(fields: [chatId], references: [id])
  user     User          @relation(fields: [senderId], references: [id])

  @@map("messages")
}

enum UserRole {
  common
  admin
}

enum EventRole {
  owner
  speaker
  participant
}

enum ChatType {
  private
  event
}

enum MessageStatus {
  delivered
  received
  readed
}
